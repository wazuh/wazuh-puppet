  <!-- Most of these rules are defined in the shared agent config -->
  <syscheck>
    <!-- Frequency that syscheck is executed -->
    <frequency><%= @ossec_syscheck_frequency %></frequency>
    <scan_on_start><%= @ossec_syscheck_scan_on_start %></scan_on_start>
    <alert_new_files>yes</alert_new_files>
    <auto_ignore><%= @ossec_auto_ignore %></auto_ignore>

    <!-- Directories to check  (perform all possible verifications) -->
    <%- @ossec_scanpaths.each do |scanpath| -%>    <directories check_all="yes" report_changes="<%= scanpath["report_changes"] %>" realtime="<%= scanpath['realtime'] %>"><%= scanpath['path']  %></directories>
<%- end -%>

    <!-- Files/directories to ignore (parameterized) -->
  <%- @ossec_ignorepaths.each do |path| -%>
    <ignore><%= path %></ignore>
  <%- end -%>
  <%- if @ossec_prefilter == true then %>
    <prefilter_cmd>/usr/sbin/prelink -y</prefilter_cmd>
  <%- end -%>
  <%- if @ossec_nodiff then -%>
    <%- @ossec_nodiff.each do |path| -%>
    <nodiff><%= path %></nodiff>
    <%- end -%>
  <%- end -%>
  </syscheck>
  <%- if @ossec_rootcheck == false then -%>
  <rootcheck>
    <disabled>yes</disabled>
  <rootcheck>
  <%- if @ossec_rootcheck_frequency then -%>
    <frequency><%= @ossec_rootcheck_frequency %></frequency>
  <%- end -%>
  <%- if @ossec_rootcheck_checkports == false then -%>
    <check_ports>no</check_ports>
  <%- end -%>
  <%- if @ossec_rootcheck_checkfiles == false then -%>
    <check_files>no</check_files>
  <%- end -%>
  </rootcheck>
  <%- end -%>
  <%- if @ossec_rootcheck == true then -%>
    <%= scope.function_template(["wazuh/fragments/_rootcheck_linux.erb"]) %>
  <%- end -%>
<%- if @ar_repeated_offenders != '' and @ossec_active_response -%>
  <active-response>
    <repeated_offenders><%= @ar_repeated_offenders %></repeated_offenders>
  </active-response>
<%- elsif !@ossec_active_response -%>
  <active-response>
    <disabled>yes</disabled>
  </active-response>
<%- end -%>


  <!-- Files to monitor (localfiles) -->
<%- @ossec_local_files.sort.each do |path, format| -%>
  <localfile>
    <log_format><%= format %></log_format>
    <location><%= path %></location>
  </localfile>
<%- end %>

<%- if @kernel == 'Linux' -%>
  <localfile>
    <log_format>command</log_format>
    <command>df -P</command>
    <frequency>360</frequency>
  </localfile>

  <localfile>
    <log_format>full_command</log_format>
    <command>netstat -tln | grep -v 127.0.0.1 | sort</command>
    <frequency>360</frequency>
  </localfile>

  <localfile>
    <log_format>full_command</log_format>
    <command>last -n 20</command>
    <frequency>360</frequency>
  </localfile>
<%- end %>
