# Wazuh - Filebeat configuration file
filebeat.modules:
  - module: wazuh
    alerts:
      enabled: true
    archives:
      enabled: false

setup.template.json.enabled: true
setup.template.json.path: "/etc/filebeat/wazuh-template.json"
setup.template.json.name: "wazuh"
setup.template.overwrite: true

# Send events directly to Elasticsearch
output.elasticsearch:
  hosts: ["<%= @filebeat_elasticsearch_proto %>://<%= @filebeat_elasticsearch_ip %>:<%= @filebeat_elasticsearch_port %>"]
<% if @filebeat_elastic_api_key -%>
  api_key: <%= @filebeat_elastic_api_key %>
<% else -%>
<% if @filebeat_elastic_password -%>
  username: <%= @filebeat_elastic_user %>
  password: <%= @filebeat_elastic_password %>
<% end -%>
<% end -%>
<% if @filebeat_ssl_verification -%>
  ssl.verification_mode: <%= @filebeat_ssl_verification %>
<% end -%>
<% if @filebeat_elastic_worker > 1 -%>
  worker: <%= @filebeat_elastic_worker %>
<% end -%>

<% if not @filebeat_setup_ilm_enabled.nil? %>
setup.ilm.enabled: <%= @filebeat_setup_ilm_enabled %>
<% end -%>

<% if @filebeat_log_level -%>
logging.level: <%= @filebeat_log_level %>
logging.selectors: [ "*" ]
logging.to_stderr: false
logging.to_syslog: false
logging.metrics.enabled: true
logging.metrics.period: 300s
logging.to_files: true
logging.files:
  path: /var/log/filebeat
  name: filebeat
  rotateeverybytes: 10485760
  keepfiles: <%= @filebeat_log_keep %>
  permissions: 0644
  interval: <%= @filebeat_log_interval %>
<% end -%>
